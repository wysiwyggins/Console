<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sketch Controller</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load socket.io client -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <!-- Load p5.js and p5.sound.js -->
    <script type="text/javascript" src="scripts/p5.js"></script>
    <script type="text/javascript" src="scripts/p5.sound.js"></script>
</head>
<body>
    <main id="sketch-container"></main>

    <script>
        (function() {
            const socket = io(); // This 'socket' is now locally scoped to the function
        
            let currentSketch = null;
        
            function unloadCurrentSketch() {
                const sketchContainer = document.getElementById('sketch-container');
                sketchContainer.innerHTML = '';  // Remove all child nodes
                console.log('Previous sketch unloaded');
            }
        
            function loadSketch(sketchIndex) {
                unloadCurrentSketch();  // Ensure the previous sketch is unloaded
                const sketchContainer = document.getElementById('sketch-container');
                
            // Map index to sketch script paths
            const sketches = {
                0: 'scripts/boot.js',
                1: 'scripts/geomancy.js',
                2: 'scripts/home.js', 
                3: 'scripts/game.js',
                4: 'scripts/abyss.js',
                5: 'scripts/keyboard.js',
                6: 'scripts/patterns.js',
                7: 'scripts/mirror.js',
                8: 'scripts/automata.js'
            };
        
            const sketchScript = sketches[sketchIndex % Object.keys(sketches).length];
        
            if (sketchScript) {
                const scriptTag = document.createElement('script');
                scriptTag.src = sketchScript;
                scriptTag.onload = () => console.log(`Loaded sketch: ${sketchScript}`);
                scriptTag.onerror = () => console.error(`Error loading sketch: ${sketchScript}`);
                sketchContainer.appendChild(scriptTag);
                currentSketch = scriptTag;
            }
        }

        socket.on('changeSketch', function(sketchIndex) {
            console.log('Switch to sketch index:', sketchIndex);
            loadSketch(sketchIndex);
        });

        loadSketch(0);
    })();
    </script>
    
</body>
</html>
